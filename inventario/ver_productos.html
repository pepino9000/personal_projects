<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  </head>
  <style>
/*Tabla*/
table {
        border-collapse: collapse;
        margin: auto;
      }

      th,
      td {
        border: 1px solid #000;
      }

      .d-block {
        height: 150%;
      }

      table {
        font-family: Arial, Helvetica, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }

      table td,
      table th {
        border: 1px solid #ddd;
        padding: 8px;
      }

      table tr:nth-child(even) {
        background-color: #f2f2f2;
      }

      table tr:hover {
        background-color: #ddd;
      }

      thead > tr {
        padding-top: 12px;
        padding-bottom: 12px;
        text-align: left;
        background-color: #19c77b;
        color: white;
      }
      .input-group-prepend label {
        display: block;
        text-align: right;
        line-height: 150%;
        color: white;
        font-weight: 500;
      }
      table td {
        width: 12.5%;
      }
      .float-left {
        float: left;
      }
      /*Fin tabla*/    
    .float-left{
      float: left;
    }
    .wider{
      width: 400px;
    }
    .btn{
      text-decoration: none;
    }
  </style>
  <body>
    <div class="container my-5">
      <div id="form_change">
        <h2>Inventario de productos</h2>
        <br>
          <div>
            <div class="form-group row">
              <label for="name" class="col-sm-2 col-form-label">Nombre:</label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control"
                  id="nombre"
                  value="A dios le pido"
                />
              </div>
            </div>
            <div class="form-group row">
              <label for="email" class="col-sm-2 col-form-label">Precio: </label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control"
                  id="precio"
                  value="Juanes"
                />
              </div>
            </div>
            <div class="form-group row">
              <label for="rut" class="col-sm-2 col-form-label">Costo:</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="costo" value="Em" />
              </div>
            </div>
            <div class="form-group row">
              <label for="rut" class="col-sm-2 col-form-label"
                >Descripcion:</label
              >
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control"
                  id="descripcion"
                  value="Em"
                />
              </div>
            </div>
            <div class="form-group row">
              <label for="rut" class="col-sm-2 col-form-label">Codigo:</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="codigo" value="Em" />
              </div>
            </div>
            <div class="form-group row">
              <label for="rut" class="col-sm-2 col-form-label">Categoria:</label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control"
                  id="id_categorias"
                  value="Em"
                />
              </div>
            </div>
            <button
              onclick="editarProducto()"
              id="editar"
              class="my-4 btn btn-info float-left wider"
            >
              Editar
            </button>
            <br />
            <br />            
          </div>
        </div>
    </div>
    </div>
    <div id="ListaProductos">
      <div class="container">
        <h2>Tabla de productos</h2>
      </div>
      <br>
        <table class="table">
          <thead>
            <tr>
              <th scope="col">NÃºmero</th>
              <th scope="col">Nombre</th>
              <th scope="col">Precio</th>
              <th scope="col">Costo</th>
              <th scope="col">Descripcion</th>
              <th scope="col">Codigo</th>
              <th scope="col">Id Categoria</th>
              <th scope="col">Acciones</th>
            </tr>
          </thead>
          <tbody id="cuerpo"></tbody>
        </table>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </body>
  <script>
    let url = "https://pepino9000.github.io/personal_projects/inventario/producto";
    let tbody = document.getElementById("cuerpo");
    let nombre = document.getElementById("nombre");
    let precio = document.getElementById("precio");
    let costo = document.getElementById("costo");
    let descripcion = document.getElementById("descripcion");
    let codigo = document.getElementById("codigo");
    let id_categorias = document.getElementById("id_categorias");

    let productos = [];
    window.onload = getData();
    window.onload = document.getElementById("form_change").style.display =
      "none";

    async function getData() {
      await axios.get(url + "s").then((data) => {
        productos = data.data.rows;
        function compare(a, b) {
          if (a.id_productos < b.id_productos) {
            return -1;
          }
          if (a.id_productos > b.id_productos) {
            return 1;
          }
          return 0;
        }
        productos.sort(compare);
        tbody.innerHTML = "";
        productos.forEach((c, i) => {
          tbody.innerHTML += `
        <tr>
          <td>${i + 1}</td>
          <td>${c.nombre}</td>
          <td>${c.precio}</td>
          <td>${c.costo}</td>
          <td>${c.descripcion}</td>
          <td>${c.codigo}</td>
          <td>${c.id_categorias}</td>
          <td>
            <button class="btn btn-link no-deco" onclick="prepararProducto(${i},'${
            c.id_productos
          }')">Editar</button>
            <button class="btn btn-link" onclick="eliminarProducto(${i},'${
            c.id_productos
          }')">Eliminar</button>
          </td>
        </tr>
      `;
        });
      });
      nombre.value = "";
      precio.value = "";
      costo.value = "";
      descripcion.value = "";
      codigo.value = "";
      id_categorias.value = "";
    }
    function eliminarProducto(i, id) {
      axios.delete(url + "?id=" + id).then(() => {
        alert("Producto " + productos[i].nombre + " eliminado");
        getData();
      });
    }
    function prepararProducto(i, id) {
      nombre.value = productos[i].nombre;
      precio.value = productos[i].precio;
      costo.value = productos[i].costo;
      descripcion.value = productos[i].descripcion;
      codigo.value = productos[i].codigo;
      id_categorias.value = productos[i].id_categorias;
      document
        .getElementById("editar")
        .setAttribute("onclick", `editarProducto('${id}')`);
      document.getElementById("form_change").style.display = "block";
      document.getElementById("editar").style.display = "block";
    }

    function editarProducto(id) {
      console.log(id);
      axios
        .put(url, {
          nombre: nombre.value,
          precio: precio.value,
          costo: costo.value,
          descripcion: descripcion.value,
          codigo: codigo.value,
          id_categorias: id_categorias.value,
          id_productos: id,
        })
        .then(() => {
          getData();
          document.getElementById("form_change").style.display = "none";
          document.getElementById("editar").style.display = "none";
        });
    }
  </script>
</html>
